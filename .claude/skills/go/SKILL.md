# /go - 統合コマンド（メインコマンド）

これだけ覚えればOK！クエスト進行・完了・ヒント・ステータス・ボス戦を1コマンドで。

## 使用方法

```
/go           → 次のクエストを表示（初回はゲーム開始演出付き）
/go done      → クエスト完了 → BP付与 → 自動で次のクエスト表示
/go hint      → 段階的ヒント表示（3段階）
/go status    → コンパクトなステータス表示
/go boss      → ボス戦開始
/go [番号]    → 指定クエストに移動
```

## 自然言語トリガー

ユーザーが以下のように発言した場合は `/go done` として処理する：
- 「できた」「完了」「done」「クリア」「終わった」「できました」「やった」「おわり」

## 起動時の動作

1. `gorilla_data/progress.json` を読み込む
2. 引数に応じて処理を分岐

## 処理分岐

### `/go`（引数なし）- 次のクエスト表示

1. progress.json の `quests.current` を確認
2. current が null の場合、completed リストから次のクエスト番号を特定
3. quest_file_map からクエストファイルパスを取得
4. クエストファイルを読み込む
5. コンパクトフォーマットで表示
6. progress.json の current を更新

**初回（completedが空 or Q1,Q1.5のみ）の場合、短い開始演出を入れる：**
```
🦍 ウホッ！デジタルジャングルへようこそ！
  冒険を始めるぞ！「できた」って言えば次に進むからな！
```

**クエスト表示フォーマット（コンパクト版）：**
```
🦍 Q[番号] [クエスト名]  [エリア絵文字][エリア名]
─────────────────────────
[導入テキスト（2-3行に短縮）]

やること：
[目標リスト（箇条書き）]

📋 コピペ：
  [コピペ用コマンドや入力テキスト]  ← [簡単な説明]

できたら「できた」って言ってね！
💡 わからなかったら /go hint
```

**コピペセクション**はクエストファイルに `## コピペ` セクションがあればそれを使う。なければヒント3の内容から抽出。

### `/go done` - クエスト完了 + 自動進行

1. progress.json を読み込む
2. 現在のクエスト（current）を特定
3. クエストファイルから成功条件を読み込む
4. 可能な範囲で自動検証（ファイル存在確認など）
5. 完了処理：BP付与、レベルアップ判定
6. progress.json を更新
7. **完了表示 + 次のクエストを自動で表示**

**完了+自動進行フォーマット：**
```
🍌 Q[番号] クリア！ +[BP] BP
[プログレスバー] Lv.[レベル] [称号絵文字][称号]
```

レベルアップした場合のみ追加：
```
⚡ レベルアップ！ Lv.[旧] → Lv.[新]
```

称号が変わった場合のみ追加：
```
🦍 進化！ [旧称号] → [新称号]
```

バッジ獲得時のみ追加：
```
🏆 バッジ「[バッジ名]」獲得！
```

**その後、区切り線を挟んで次のクエストを自動表示：**
```
─────────────────────────
🦍 Q[次の番号] [次のクエスト名]  [エリア絵文字][エリア名]
─────────────────────────
[次のクエスト内容...]
```

エリアの全クエスト完了時：
```
🔥 [エリア名]の全クエストクリア！ボス戦が解禁されたぞ！
  /go boss でボスに挑め！
```

### `/go hint` - 段階的ヒント

1. progress.json から current と hint_count を取得
2. クエストファイルのヒントセクションを読み込む
3. hint_count に応じて段階的に表示（1→2→3）
4. hint_count をインクリメントして保存

**ヒントフォーマット（コンパクト版）：**
```
💡 ヒント [1-3]/3
[ヒント内容]
```

3回目はほぼ答え：
```
💡 ヒント 3/3（最終ヒント）
[ほぼ答えの内容]
📚 参考: docs/reference/[xx].md
```

### `/go status` - コンパクトステータス

1. progress.json を読み込む
2. コンパクトに表示

**フォーマット：**
```
🦍 [プレイヤー名] | [称号絵文字][称号] | Lv.[レベル]
[プログレスバー] [現在BP]/[次レベルBP] BP

📍 [エリア名] Q[現在クエスト番号]
🌿[完了]/7 🌲[完了]/6 ⛰️[完了]/6 🕳️[完了]/6 👑[完了]/6
🎖️ [獲得バッジアイコン列]
```

プログレスバーは16文字: `[██████░░░░░░░░░░]`

### `/go boss` - ボス戦

1. progress.json を読み込む
2. 現在エリアの boss_available を確認
3. ボス戦可能ならボスファイルを読み込んで表示
4. 不可の場合は残りクエスト数を表示

ボス戦の演出は既存の `/boss` スキルと同等（ドラミング演出付き）。
ただし、完了報告は `/go done` で行う。

### `/go [番号]` - 指定クエスト移動

1. 番号のバリデーション
2. 未解放エリアのクエストは不可
3. quest_file_map から該当クエストを読み込み
4. current を更新して表示

## progress.json 更新ルール

`/go done` 実行時：
- `banana_points` を加算（base_bp + first_clear_bonus）
- `power_level` を更新（level_thresholds で判定）
- `title` を更新（title_levels で判定）
- `quests.completed` に追加（重複なし）
- `quests.current` を次のクエスト番号に更新（null にしない）
- 該当エリアの `quests_completed` をインクリメント
- `badges` に新規バッジ追加（条件達成時）
- エリア全クリア時は `boss_available` を true に
- `last_played` を今日の日付に更新

## エリア絵文字マッピング

| エリア | 絵文字 |
|--------|--------|
| grassland | 🌿草原 |
| forest | 🌲森林 |
| mountain | ⛰️山岳 |
| cave | 🕳️洞窟 |
| summit | 👑頂上 |

## 称号絵文字マッピング

| 称号 | 絵文字 |
|------|--------|
| 子ゴリラ | 🐵 |
| 若ゴリラ | 🦧 |
| 成熟ゴリラ | 🦍 |
| ブラックバック | 🦍💪 |
| シルバーバック | 🦍✨ |
| ジャングルの王 | 👑🦍 |
