# /banana - クエスト完了判定

クエストの完了を判定し、バナナポイントを付与する。

## 起動時の動作

1. `gorilla_data/progress.json` を読み込む
2. 現在のクエスト（current）を特定
3. `quest_file_map` からクエストファイルパスを取得し、成功条件を読み込む
4. ユーザーに確認（実際に条件を満たしたか）
5. 完了判定・BP付与・レベルアップ処理

## BP計算

クエストファイルの `## 🍌 報酬` セクションから `base_bp` と `first_clear_bonus` を読み取る。

- 初回クリア: base_bp + first_clear_bonus
- 再クリア: base_bp のみ

## レベルアップ判定

progress.json の `level_thresholds` を参照し、現在のBP合計がどのレベルに該当するかを判定。
レベル1〜100まで定義済み。

## 称号判定

progress.json の `title_levels` を参照し、レベルに応じた称号を判定。

| 称号 | レベル範囲 |
|------|-----------|
| 子ゴリラ | 1-8 |
| 若ゴリラ | 9-20 |
| 成熟ゴリラ | 21-35 |
| ブラックバック | 36-50 |
| シルバーバック | 51-70 |
| ジャングルの王 | 71-80 |
| 伝説のキングコング | 81-100 |

## 成功条件の確認方法

クエストの成功条件は基本的に自己申告制。
ただし、一部のクエストでは検証可能なものもある：

- ファイルの存在確認
- コマンドの実行結果確認
- 設定ファイルの内容確認

## 完了時の演出

### 通常完了
```
🍌🍌🍌🍌🍌🍌🍌🍌🍌🍌

  ウホホホーーー！！！

  Quest [番号] クリア！

  🍌 +[BP] バナナポイント獲得！

  [現在のBP] / [次のレベルまで] BP

🍌🍌🍌🍌🍌🍌🍌🍌🍌🍌
```

### レベルアップ時
```
🦍💥⚡💥🦍

  ドドドドドド...

  ＊ドラミング＊

  レベルアップ！！！

  Lv.[旧レベル] → Lv.[新レベル]

  [称号が変わった場合]
  進化！ [旧称号] → [新称号]

🦍💥⚡💥🦍
```

### バッジ獲得時
```
🏆✨ NEW BADGE ✨🏆

  バッジ「[バッジ名]」を獲得！

  [バッジの説明]
```

## progress.json更新

- `banana_points` を加算
- `power_level` を更新（`level_thresholds` で閾値を超えた場合）
- `title` を更新（`title_levels` でレベルに応じて）
- `quests.completed` に追加
- `quests.current` を null に
- 該当エリアの `quests_completed` をインクリメント
- `badges` に新規バッジを追加（`badges_definition` で条件達成時）
- エリア全クリア時は `boss_available` を true に

## バッジ付与条件

progress.json の `badges_definition` を参照。全19バッジ定義済み。
主な条件：
- Q1, Q6, Q12, Q18, Q24, Q30, Q36, Q42, Q48, Q54 クリア時
- 各エリアボス撃破時
